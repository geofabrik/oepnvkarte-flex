# Various parts to be included later on
_parts:
  srid: &srid "3857"
  srs: &srs "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over"
  srs_wsg84: &srs_wsg84 "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
  world: &world
    - -180
    - -85.05112877980659
    - 180
    - 85.05112877980659
  extents: &extents
    extent: *world
    srs-name: *srid
    srs: *srs
  extents_wsg84: &extents_wsg84
    extent: *world
    srs-name: autodetect
    srs: *srs_wsg84
  osm2pgsql: &osm2pgsql
    type: "postgis"
    dbname: "gis"
    key_field: ""
    geometry_field: "geom"
    srid: *srid
    extent: "-20037508,-20037508,20037508,20037508"


name: oepnvkarte
description: ''
bounds: *world
srs: *srs
center: [0, 0, 2]
format: png
interactivity: false
minzoom: 0
maxzoom: 22
scale: 1
metatile: 2



Stylesheet:
  - style.mms
  - ground.mms
  - road.mms
  - poi.mms
  - places.mms
  - transport.mms
  - rail.mms

Layer:
  - id: land0
    geometry: polygon
    <<: *extents_wsg84
    properties:
      minzoom: 0
      maxzoom: 1
    class: land
    Datasource:
      file: data/110m_physical/ne_110m_land.shp
      type: shape
    layer: null
    advanced: {}
    name: land0

  - id: land1
    geometry: polygon
    <<: *extents_wsg84
    properties:
      minzoom: 2
      maxzoom: 4
    class: land
    Datasource:
      file: data/50m_physical/ne_50m_land.shp
      type: shape
    layer: null
    advanced: {}
    name: land1

  - id: land2
    geometry: polygon
    <<: *extents_wsg84
    properties:
      minzoom: 5
      maxzoom: 7
    class: land
    Datasource:
      file: data/10m_physical/ne_10m_land.shp
      type: shape
    layer: null
    advanced: {}
    name: land2

  - id: land3
    geometry: polygon
    <<: *extents
    properties:
      minzoom: 8
      maxzoom: 22
    class: land
    Datasource:
      file: data/land-polygons-split-3857/land_polygons.shp
      type: shape
    layer: null
    advanced: {}
    name: land3

  - id: lakes0
    geometry: polygon
    <<: *extents_wsg84
    properties:
      minzoom: 0
      maxzoom: 1
    class: lakes
    Datasource:
      file: data/110m_physical/ne_110m_lakes.shp
      type: shape
    layer: null
    advanced: {}
    name: lakes0

  - id: lakes1
    geometry: polygon
    <<: *extents_wsg84
    properties:
      minzoom: 2
      maxzoom: 4
    class: lakes
    Datasource:
      file: data/50m_physical/ne_50m_lakes.shp
      type: shape
    layer: null
    advanced: {}
    name: lakes1

  - id: lakes2
    geometry: polygon
    <<: *extents_wsg84
    properties:
      minzoom: 5
      maxzoom: 7
    class: lakes
    Datasource:
      file: data/10m_physical/ne_10m_lakes.shp
      type: shape
    layer: null
    advanced: {}
    name: lakes2

  - id: citylike0
    geometry: polygon
    <<: *extents_wsg84
    properties:
      minzoom: 2
      maxzoom: 4
    class: citylike
    Datasource:
      file: data/50m_cultural/ne_50m_urban_areas.shp
      type: shape
    layer: null
    advanced: {}
    name: citylike0

  - id: citylike1
    geometry: polygon
    <<: *extents_wsg84
    properties:
      minzoom: 5
      maxzoom: 7
    class: citylike
    Datasource:
      file: data/10m_cultural/ne_10m_urban_areas.shp
      type: shape
    layer: null
    advanced: {}
    name: citylike1

  - id: border0
    geometry: linestring
    <<: *extents_wsg84
    properties:
      minzoom: 1
      maxzoom: 2
    class: border
    Datasource:
      file: data/110m_cultural/ne_110m_admin_0_boundary_lines_land.shp
      type: shape
    layer: null
    advanced: {}
    name: border0

  - id: area00
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text, type as "order" FROM oepnv_verylargeareas WHERE
        type IN('forest') ORDER BY "order" ASC) AS area
    properties:
      minzoom: 4
      maxzoom: 7
    class: area
    advanced: {}
    name: area00

  - id: area0
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text, type as "order" FROM oepnv_verylargeareas ORDER
        BY "order" ASC) AS area
    properties:
      minzoom: 8
      maxzoom: 9
    class: area
    advanced: {}
    name: area0

  - id: area1
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text, type as "order" FROM oepnv_largeareas ORDER
        BY "order" ASC) AS area
    properties:
      minzoom: 10
      maxzoom: 11
    class: area
    srs-name: '900913'
    srs: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0
      +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over
    advanced: {}
    name: area1

  - id: area2
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text FROM (SELECT geom,type::text FROM oepnv_areas
        ORDER BY type) as oepnv_areas) AS area
    properties:
      minzoom: 12
      maxzoom: 15
    class: area
    advanced: {}
    name: area2

  - id: area3
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text FROM (SELECT geom,type::text FROM (SELECT type,
        geom FROM oepnv_areas ORDER BY type) as aa UNION ALL SELECT geom, 'building'
        as type FROM oepnv_buildings) as oepnv_areas) AS area
    properties:
      minzoom: 16
      maxzoom: 22
    class: area
    advanced: {}
    name: area3

  - id: waterway0
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text, "type" as "order", name FROM oepnv_waterways
        ORDER BY "order" DESC) AS waterways
    properties:
      minzoom: 8
      maxzoom: 12
    class: waterway
      +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over
    advanced: {}
    name: waterway0

  - id: waterway1
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text, "type" as "order", name FROM oepnv_waterways
        UNION ALL SELECT geom, type::text, "type" as "order", name FROM oepnv_minorwaterways
        ORDER BY "order" DESC) AS waterways
    properties:
      minzoom: 13
      maxzoom: 22
    class: waterway
      +units=m +nadgrids=@null +no_defs +over
    advanced: {}
    name: waterway1

  - id: way0
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text, "type" as "order", '' as name, 'false' as tunnel,
        'false' as bridge, 'false' as oneway, 0 AS ref_length, '' AS ref_content FROM
        oepnv_largeways ORDER BY "order" DESC) AS ways
    properties:
      minzoom: 8
      maxzoom: 9
    class: way
    advanced: {}
    name: way0

  - id: way1
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text, "type" as "order", name, tunnel::text, bridge::text,
        oneway::text, CHAR_LENGTH(ref) AS ref_length, (CASE WHEN CHAR_LENGTH(ref)
        BETWEEN 2 AND 9 THEN ref ELSE NULL END) AS ref_content FROM oepnv_ways ORDER
        BY layer ASC, tunnel DESC, bridge ASC, "order" DESC) AS ways
    properties:
      minzoom: 10
      maxzoom: 13
    class: way
    advanced: {}
    name: way1

  - id: way2
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text, "type" as "order", name, tunnel::text, bridge::text,
        oneway::text, CHAR_LENGTH(ref) AS ref_length, (CASE WHEN CHAR_LENGTH(ref)
        BETWEEN 2 AND 9 THEN ref ELSE NULL END) AS ref_content FROM (SELECT name,
        ref, "type", oneway, tunnel, bridge, layer, geom FROM oepnv_ways UNION ALL
        SELECT name,'' as ref, "type", oneway, tunnel, bridge, layer, geom FROM oepnv_minorways)
        as w ORDER BY layer ASC, tunnel DESC, bridge ASC, "order" DESC) AS ways
    properties:
      minzoom: 14
      maxzoom: 22
    class: way
    advanced: {}
    name: way2

  - id: rail0
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT type::text, geom, tunnel::text FROM oepnv_rails WHERE usage IN
        ('highspeed','main', 'branch') ORDER BY layer ASC) AS rail
    properties:
      minzoom: 6
      maxzoom: 12
    class: rail line
    advanced: {}
    name: rail0
    layerId: rail0

  - id: rail1
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT type::text, geom, tunnel::text FROM oepnv_rails WHERE usage NOT
        IN ('service') ORDER BY layer ASC) AS rail
    properties:
      minzoom: 13
      maxzoom: 14
    class: rail line
    advanced: {}
    name: rail1
    layerId: rail1

  - id: rail2
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT type::text, geom, tunnel::text FROM oepnv_rails ORDER BY layer
        ASC) AS rail
    properties:
      minzoom: 15
      maxzoom: 22
    class: rail line
    advanced: {}
    name: rail2
    layerId: rail2
    
  - id: waybridges0
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text, "type" as "order", name, tunnel::text, bridge::text,
        oneway::text, CHAR_LENGTH(ref) AS ref_length, (CASE WHEN CHAR_LENGTH(ref)
        BETWEEN 2 AND 9 THEN ref ELSE NULL END) AS ref_content FROM (SELECT name,
        ref, "type", oneway, tunnel, bridge, layer, geom FROM oepnv_ways WHERE bridge
        UNION ALL SELECT name,'' as ref, "type", oneway, tunnel, bridge, layer, geom
        FROM oepnv_minorways WHERE bridge) as w ORDER BY layer ASC, tunnel DESC, bridge
        ASC, "order" DESC) AS ways
    properties:
      minzoom: 15
      maxzoom: 22
    class: way bridge
    advanced: {}
    name: waybridges0

  - id: stateborder0
    geometry: linestring
    <<: *extents_wsg84
    properties:
      minzoom: 0
      maxzoom: 2
    class: stateborder line
    Datasource:
      file: data/110m_cultural/ne_110m_admin_0_countries.shp
      type: shape
    layer: null
    advanced: {}
    name: stateborder0

  - id: stateborder1
    geometry: linestring
    <<: *extents_wsg84
    properties:
      minzoom: 3
      maxzoom: 4
    class: stateborder line
    Datasource:
      file: data/50m_cultural/ne_50m_admin_0_boundary_lines_land.shp
      type: shape
    layer: null
    srs-name: autodetect
    srs: +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
    advanced: {}
    name: stateborder1

  - id: stateborder2
    geometry: linestring
    <<: *extents_wsg84
    properties:
      minzoom: 5
      maxzoom: 7
    class: stateborder line
    Datasource:
      file: data/10m_cultural/ne_10m_admin_0_boundary_lines_land.shp
      type: shape
    layer: null
    srs-name: autodetect
    srs: +proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs
    advanced: {}
    name: stateborder2

  - id: border0
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT type::text, geom, level FROM oepnv_largeboundary_ways ORDER BY
        level ASC) AS borders
    properties:
      minzoom: 8
      maxzoom: 10
    class: border line
    advanced: {}
    name: border0

  - id: border1
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT type::text, geom, level FROM oepnv_boundary_ways ORDER BY level
        ASC) AS borders
    properties:
      minzoom: 11
      maxzoom: 22
    class: border line
    advanced: {}
    name: border1

  - id: stationarea0
    geometry: polygon
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT name, area as geom, type::text,"type" as "order" FROM oepnv_stations
        ORDER BY "order" ASC) AS areas
    properties:
      minzoom: 17
      maxzoom: 22
    class: stationarea all
    advanced: {}
    name: stationarea0

  - id: transport0
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT refs,"type"::text, type as "order",geom,role FROM oepnv_line_parts
        WHERE type IN ('rail') ORDER BY "order" DESC) AS transport
    properties:
      minzoom: 6
      maxzoom: 8
    class: transport line
    advanced: {}
    name: transport0

  - id: transport1
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT refs,"type"::text, type as "order",geom,role FROM oepnv_line_parts
        ORDER BY "order" DESC) AS transport
    properties:
      minzoom: 9
      maxzoom: 22
    class: transport line
      +units=m +nadgrids=@null +no_defs +over
    advanced: {}
    name: transport1
    layerId: transport1


  - id: platform0
    extent:
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT name, ref, geom, "type"::text FROM oepnv_stops WHERE platform)
        AS platforms
    properties:
      minzoom: 17
      maxzoom: 22
    class: platform geom
    advanced: {}
    name: platform0
    layerId: platform0

  - id: airport
    geometry: point
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT name, geom, type::text,"type" as "order" FROM oepnv_airports
        ORDER BY "order" ASC, passengers DESC) AS airports
    properties:
      minzoom: 5
      maxzoom: 22
    class: airport
    advanced: {}
    name: airport

  - id: place0
    geometry: point
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT name, geom, type::text,"type" as "order" FROM oepnv_places WHERE
        type IN ('continent','country') ORDER BY "order" ASC, population DESC NULLS LAST) AS
        places
    properties:
      minzoom: 0
      maxzoom: 3
    class: place
    advanced:
      srid: '900913'
    name: place0

  - id: place1
    geometry: point
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT name, geom, type::text,"type" as "order" FROM oepnv_places WHERE
        type IN ('continent','country','city') ORDER BY "order" ASC, population DESC)
        AS places
    properties:
      minzoom: 4
      maxzoom: 8
    class: place
    advanced:
      srid: '900913'
    name: place1

  - id: place2
    geometry: point
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT name, geom, type::text,"type" as "order" FROM oepnv_places ORDER
        BY "order" ASC, population DESC) AS places
    properties:
      minzoom: 9
      maxzoom: 22
    class: place
    advanced:
      srid: '900913'
    name: place2
    layerId: place2

  - id: stationpoint
    geometry: point
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT name, point as geom, type::text,"type" as "order" FROM oepnv_stations
        ORDER BY "order" ASC) AS stations
    properties:
      minzoom: 12
      maxzoom: 22
    advanced: {}
    name: stationpoint

  - id: oepnvpoipoint
    geometry: point
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT name, geom, type::text,"type" as "order" FROM oepnv_oepnvpois
        ORDER BY "order" ASC) AS oepnvpois
    properties:
      minzoom: 14
      maxzoom: 22
    class: oepnvpoi point
    advanced: {}
    name: oepnvpoipoint
    
  - id: platformlabel
    geometry: point
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT name, ref, CASE ST_GeometryType(geom) WHEN 'ST_Point' THEN geom
        WHEN 'ST_Linestring' THEN ST_LineInterpolatePoint(geom, 0.5) ELSE st_pointonsurface(geom)
        END as geom, type::text,"type" as "order" FROM oepnv_stops WHERE geom && !bbox!
        ORDER BY "order" ASC) AS stations
    properties:
      minzoom: 17
      maxzoom: 22
    class: platform label
    advanced: {}
    name: platformlabel
    layerId: platformlabel

  - id: transportlabel0
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT refs,"type"::text, type as "order",geom,role FROM oepnv_line_parts
        WHERE type IN ('rail') ORDER BY "order" DESC) AS transport
    properties:
      minzoom: 6
      maxzoom: 8
    class: transport label
    advanced: {}
    name: transportlabel0

  - id: transportlabel1
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT refs,"type"::text, type as "order",geom,role FROM oepnv_line_parts
        ORDER BY "order" DESC) AS transport
    properties:
      minzoom: 9
      maxzoom: 22
    class: transport label
    advanced: {}
    name: transportlabel1

  - id: waylabel1
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text, "type" as "order", name, tunnel::text, bridge::text,
        oneway::text, CHAR_LENGTH(ref) AS ref_length, (CASE WHEN CHAR_LENGTH(ref)
        BETWEEN 2 AND 9 THEN ref ELSE NULL END) AS ref_content FROM oepnv_ways ORDER
        BY layer ASC,  "order" DESC) AS ways
    properties:
      minzoom: 10
      maxzoom: 13
    class: waylabel
    advanced: {}
    name: waylabel1

  - id: waylabel2
    geometry: linestring
    <<: *extents
    Datasource:
      <<: *osm2pgsql
      table: (SELECT geom, type::text, "type" as "order", name, tunnel::text, bridge::text,
        oneway::text, CHAR_LENGTH(ref) AS ref_length, (CASE WHEN CHAR_LENGTH(ref)
        BETWEEN 2 AND 9 THEN ref ELSE NULL END) AS ref_content FROM (SELECT name,
        ref, "type", oneway, tunnel, bridge, layer, geom FROM oepnv_ways UNION ALL
        SELECT name,'' as ref, "type", oneway, tunnel, bridge, layer, geom FROM oepnv_minorways)
        as w ORDER BY layer ASC,  "order" DESC) AS ways
    properties:
      minzoom: 14
      maxzoom: 22
    class: waylabel
    advanced: {}
    name: waylabel2

# vim: ft=yaml
